<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Speech Recognition</title>
</head>
<body>
    <div id="output"></div>
    <script>
        const output = document.getElementById('output');
        let recognition;
        let isRecognizing = false;

        function startRecognition() {
            if (isRecognizing) return;

            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            if (!SpeechRecognition) return;

            recognition = new SpeechRecognition();
            recognition.lang = 'en';
            recognition.continuous = true;
            recognition.interimResults = true;

            recognition.onresult = (event) => {
                let final = '';
                let interim = '';
                for (let i = event.resultIndex; i < event.results.length; i++) {
                    const trans = event.results[i][0].transcript;
                    if (event.results[i].isFinal) {
                        final += trans + ' ';
                    } else {
                        interim = trans;
                    }
                }
                output.textContent = final + interim;
            };

            recognition.onerror = (event) => {
                if (['no-speech', 'audio-capture', 'network'].includes(event.error)) {
                    setTimeout(() => { if (isRecognizing) recognition.start(); }, 1000);
                }
            };

            recognition.onend = () => {
                if (isRecognizing) recognition.start();
            };

            recognition.start();
            isRecognizing = true;
        }

        function stopRecognition() {
            isRecognizing = false;
            if (recognition) recognition.stop();
        }
    </script>
</body>
</html>